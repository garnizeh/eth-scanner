# P04-T060: Implement UTC timestamp handling for expires_at — Done

**Phase:** P04 - Master API - Job Management (Dynamic Batching)
**Status:** Done
**Completed:** 2026-02-15
**Priority:** High
**Dependencies:** P04-T050
**Effort:** Small (<1h)

---

## Summary

Ensured UTC is used consistently for all timestamp handling related to job leases and API responses. Added tests and small code adjustments to enforce UTC usage when creating leases and measuring durations.

## Acceptance Criteria (completed)

- [x] All `time.Now()` uses reviewed and `.UTC()` enforced where appropriate
- [x] Lease expiration calculated via UTC-based duration
- [x] Database stores timestamps in UTC (migrations use datetime('now', 'utc'))
- [x] API responses serialize timestamps in ISO8601 UTC (RFC3339 with trailing Z)
- [x] Test added to verify `expires_at` is in UTC

## Files changed / added

- `go/internal/jobs/manager.go` — ensure lease seconds passed to DB and UTC semantics
- `go/internal/jobs/manager_test.go` — added `TestCreateBatch_ExpiresAtIsUTC`
- `go/internal/server/server_test.go` — minor UTC usage in timing
- `go/internal/server/jobs.go` — handler logic already uses UTC for response formatting

## How it was verified

- Unit tests: `go test ./internal/jobs -run TestCreateBatch_ExpiresAtIsUTC` — passed
- Full test suite: `make test` — all tests passed locally

## Notes

- Schema and SQL use `datetime('now', 'utc')` for DB-side timestamps.
- Consider adding a staticcheck rule or CI job to detect `time.Local` usage if desired.

---

Task completed and moved to done.
