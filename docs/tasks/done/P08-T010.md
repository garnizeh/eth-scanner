# P08-T010: Integrate trezor-crypto or micro-ecc as a CMake component (Xtensa optimized). [COMPLETED]

**Phase:** P08 - ESP32 Worker - Crypto & Computation  
**Status:** Completed  
**Priority:** High  
**Dependencies:** P07-T010  
**Estimated Effort:** Medium

---

## Description

Integrate a high-performance cryptographic library for `secp256k1` operations on the ESP32. The library should be integrated as an ESP-IDF component in `esp32/components/` and configured to use Xtensa-optimized assembly where possible for maximum keys/sec.

## Acceptance Criteria

- [x] Choose either `trezor-crypto` or `micro-ecc` (or a specific ESP32 port like `esp-crypto-components`).
- [x] Add the chosen library to `esp32/components/` as an ESP-IDF component.
- [x] Update `esp32/CMakeLists.txt` to include the new component.
- [x] Verify the library builds successfully within the ESP-IDF environment.
- [x] Ensure that it can successfully perform `secp256k1` point multiplication given a private key.

## Implementation Notes

- Integrated `trezor-crypto` as a submodule-like git clone into `esp32/components/trezor-crypto`.
- Added a custom `CMakeLists.txt` to the component for ESP-IDF compatibility.
- Configured with `USE_ETHEREUM=1`, `USE_KECCAK=1`, `USE_PRECOMPUTED_CP=1` for performance.
- Added ESP32 hardware TRNG bridge for `random32()` in `rand_esp32.c`.
- Suppressed some warnings (`-Wno-array-parameter`) to avoid treating them as errors in the older code.

## Testing

- Created `esp32/test/test_crypto.c` with a test case for `secp256k1` point multiplication.
- Verified test result: `test/test_runner.c:96:test_crypto_secp256k1_point_multiplication:PASS`.
- Total test time: ~78 seconds (including WiFi initialization).

## References

- SDD: `docs/architecture/system-design-document.md` (section 3.A)
- Task P07-T010: Initialize PlatformIO project
