# P06-T030: Implement key construction (prefix_28 + nonce)

**Phase:** P06 - PC Worker - Crypto & Scanning Engine  
**Status:** Completed  
**Priority:** High  
**Dependencies:** P06-T020  
**Estimated Effort:** Medium (1-3h)

**Completed:** 2026-02-15  
**Summary:** Added `ConstructPrivateKey` to assemble a 32-byte private key from a 28-byte prefix plus a little-endian nonce, along with targeted unit tests and a benchmark that proves the helper operates without heap allocations.

---

## Description

Implement the `ConstructPrivateKey()` function that combines a 28-byte prefix with a 4-byte nonce (little-endian) to produce a full 32-byte private key. This is the core space-partitioning strategy where the master controls the prefix and workers iterate over nonce ranges.

---

## Acceptance Criteria

- [x] Function `ConstructPrivateKey(prefix28 [28]byte, nonce uint32) [32]byte` implemented
- [x] Nonce is encoded as 4-byte little-endian at the end of the key
- [x] Function is allocation-free (no heap allocations)
- [x] Unit tests verify correct byte layout (prefix at start, nonce at end)
- [x] Unit tests verify little-endian encoding of nonce
- [x] Tests cover edge cases: nonce=0, nonce=0xFFFFFFFF

---

## Implementation Notes

- The implementation lives in `internal/worker/crypto.go` and uses `encoding/binary.LittleEndian` to encode the nonce directly inside a preallocated `[32]byte` buffer, keeping the helper allocation-free.
- Unit tests now exist in `internal/worker/crypto_test.go` to confirm the prefix is preserved and the nonce bytes follow little-endian order for zero, one, max, and a deterministic pattern.
- `internal/worker/crypto_bench_test.go` gained `BenchmarkConstructPrivateKey` so the helper can be measured in isolation; the benchmark reports `0 allocs/op` in practice.

---

## Testing

- `go test ./internal/worker`
- `go test ./internal/worker -bench=ConstructPrivateKey -run=^$`

---

## References

- SDD: `docs/architecture/system-design-document.md` (Section 3.1)
- Go binary package: https://pkg.go.dev/encoding/binary
- Related tasks: P06-T040 (uses this function in scanning loop)
