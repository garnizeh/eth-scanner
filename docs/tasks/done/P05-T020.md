# P05-T020: Implement internal/worker/client.go

**Phase:** P05 - PC Worker - Core Implementation  
**Status:** Completed  
**Priority:** High  
**Dependencies:** P05-T010  
**Estimated Effort:** Medium

---

## Description

Implement HTTP client for communicating with the Master API. This client handles HTTP requests including optional API key header authentication, JSON marshaling/unmarshaling, error handling, and timeouts.

## Acceptance Criteria (implemented)

- [x] File `go/internal/worker/client.go` exists
- [x] `Client` struct defined with fields:
  - `httpClient` (*http.Client)
  - `baseURL` (string)
  - `workerID` (string)
  - `apiKey` (string)
- [x] `NewClient(config *Config)` constructor function
- [x] HTTP client configured with reasonable timeouts (30s default)
- [x] Requests include `X-API-Key` header when `apiKey` is present (optional)
- [x] Requests include `Content-Type: application/json` header
- [x] `doRequestWithContext` helper implemented for HTTP operations
- [x] Proper error handling for network errors and non-2xx status codes
- [x] Error responses from API are parsed and returned as `*APIError` (and 401 returns `ErrUnauthorized`)
- [x] UTC time handling noted where applicable

## Implementation Notes

- `go/internal/worker/client.go` implements `Client`, `NewClient`, `doRequestWithContext`, `APIError`, and `ErrUnauthorized`.
- The client will add `X-API-Key` header only if `Config.APIKey` is non-empty. If the Master API requires authentication and responds 401, the client returns `ErrUnauthorized` so the worker can log and exit.

## Testing

Unit tests added in `go/internal/worker/client_test.go` cover:

- successful requests with API key
- successful requests without API key
- parsing 4xx error responses into `APIError`
- 401 Unauthorized returns `ErrUnauthorized`
- invalid base URL triggers wrapped error from `doRequestWithContext`
- `APIError.Error()` string output

Run tests:

```bash
cd /home/user/code/garnizeh/eth-scanner/go
go test ./internal/worker -v
```

## Notes

- This task follows the updated testing directive: failure and edge cases are covered.
