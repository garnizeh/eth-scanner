# A01-T090: Fix in-memory database consistency and schema application

**Phase:** A01 - Maintenance & Bug Fixes  
**Status:** Completed  
**Priority:** High  
**Dependencies:** None  
**Estimated Effort:** Small

---

## Description

Fix failing tests in `internal/server` and `internal/database` related to missing `worker_history` and other tables when using SQLite `:memory:` mode.

## Root Cause

1. **Connection Pooling in In-Memory DB:** SQLite `:memory:` without `cache=shared` creates a unique database per connection. Using a connection pool (default `SetMaxOpenConns(10)`) caused goroutines and subsequent requests to get blank databases instead of the migrated one.
2. **Schema Statement Grouping:** The global `StatementBegin/End` in `001_schema.sql` might cause some drivers to only execute the first statement in the block or report errors incorrectly.

## Acceptance Criteria

- [x] Configure `InitDB` to use `SetMaxOpenConns(1)` for `:memory:` databases.
- [x] Refactor `001_schema.sql` to remove global `StatementBegin/End` and use it only for triggers.
- [x] Verify all tests pass with `make test`.

## Implementation Details

- Modified `go/internal/database/connection.go` to restrict pool size for in-memory databases.
- Refactored `go/internal/database/sql/001_schema.sql` for compatible Goose 3 application.
