# P05-T070: Implement batch size calculator

**Phase:** P05 - PC Worker - Core Implementation  
**Status:** Done  
**Priority:** High  
**Dependencies:** None  
**Estimated Effort:** Small

---

## Description

Implement a function to calculate the optimal batch size (nonce range) for a PC worker based on its computational capacity. The batch size should target approximately 1 hour of work to balance lease overhead with resilience to worker failures.

## Acceptance Criteria

- [x] `CalculateBatchSize(keysPerSecond uint64, targetDuration time.Duration)` function exists
- [x] Function returns batch size as `uint32`
- [x] Batch size calculation: `keysPerSecond Ã— targetDuration.Seconds()`
- [x] Result is clamped to maximum of `2^32 - 1` (full 4-byte nonce range)
- [x] Default target duration is 1 hour (3600 seconds)
- [x] Function handles edge cases (zero throughput, overflow)
- [ ] Optionally: benchmark function to measure actual throughput on current hardware

## Implementation Notes

See `go/internal/worker/batch.go` for the implementation of `CalculateBatchSize` and `go/internal/worker/batch_test.go` for unit tests that exercise edge cases and ensure full coverage.

## Completed

- Completed: 2026-02-15
- Changes: Implemented and reviewed `CalculateBatchSize`. Unit tests added/updated to achieve full statement coverage for the function and edge cases. Task file moved from `docs/tasks/backlog/` to this `docs/tasks/done/` entry.
