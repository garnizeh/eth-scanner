# P09-T040: Write integration test: Master API + SQLite (end-to-end lease flow)

**Phase:** P09 - Integration, Testing & Validation  
**Status:** Not Started  
**Priority:** High  
**Dependencies:** P04-T050, P02-T050  
**Estimated Effort:** Medium

---

## Description

Write a full integration/E2E test that starts the Master API with a temporary SQLite database and performs a sequence of: Lease → Checkpoint → Complete → Submit Result.

## Acceptance Criteria

- [ ] Test environment uses a clean temporary database.
- [ ] Verify `POST /api/v1/jobs/lease` works with a real DB.
- [ ] Verify `PATCH /api/v1/jobs/{id}/checkpoint` updates the DB correctly.
- [ ] Verify `POST /api/v1/jobs/{id}/complete` updates the DB correctly.
- [ ] Verify `POST /api/v1/results` populates any results or stats as expected.

## Implementation Notes

- Use `net/http/httptest` or start the server on a random port.

## Testing

- Successful execution of `go test ./internal/server/... -run TestE2EFlow`.

## References

- OVERVIEW: Phase 09 section.
- SDD: API Contract.
- Related: P09-T010, P04-T130+

