# P03-T030: Implement internal/api/middleware.go

**Phase:** P03 - Master API - Core Infrastructure  
**Status:** Not Started  
**Priority:** Medium  
**Dependencies:** P03-T020  
**Estimated Effort:** Small

---

## Description

Implement HTTP middleware for the Master API, including request logging, CORS headers, and request ID tracking. Middleware should be composable and follow Go best practices.

## Acceptance Criteria

- [ ] File `go/internal/api/middleware.go` exists
- [ ] `Logger` middleware implemented (logs request method, path, duration, status code)
- [ ] `CORS` middleware implemented (basic CORS headers for development)
- [ ] `RequestID` middleware implemented (generates unique ID per request)
- [ ] All middleware functions follow standard `http.Handler` signature
- [ ] Code is well-documented with comments

## Implementation Notes

**Middleware Signature:**
```go
func Logger(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        // Log request details
        // Call next handler
        // Log response details
    })
}
```

**Logger Middleware:**
- Log: timestamp (UTC), method, path, duration, status code
- Use `time.Now().UTC()` for timestamps (per time handling guidelines)
- Wrap ResponseWriter to capture status code

**CORS Middleware:**
- Set `Access-Control-Allow-Origin: *` (development only)
- Set `Access-Control-Allow-Methods: GET, POST, PATCH, OPTIONS`
- Set `Access-Control-Allow-Headers: Content-Type`
- Handle preflight OPTIONS requests

**RequestID Middleware:**
- Generate unique ID using `crypto/rand` or UUID library
- Add to request context: `context.WithValue(r.Context(), "request_id", id)`
- Add response header: `X-Request-ID: {id}`

**Time Handling:**
All timestamps must use UTC. Use `time.Now().UTC()` consistently.

## Testing

```bash
cd /home/user/code/garnizeh/eth-scanner/go
go test ./internal/api/...
```

Manual verification:
- Requests are logged with all required fields
- CORS headers present in responses
- Request ID header present in responses
- Each request gets unique ID

## References

- SDD: `docs/architecture/system-design-document.md`
- Copilot Instructions: Go Code Style - Time Handling (always UTC)
- Related tasks: P03-T020 (server.go), P03-T040 (routes.go)
