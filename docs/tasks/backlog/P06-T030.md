# P06-T030: Implement key construction (prefix_28 + nonce)

**Phase:** P06 - PC Worker - Crypto & Scanning Engine  
**Status:** Not Started  
**Priority:** High  
**Dependencies:** P06-T020  
**Estimated Effort:** Medium (1-3h)

---

## Description

Implement the `ConstructPrivateKey()` function that combines a 28-byte prefix with a 4-byte nonce (little-endian) to produce a full 32-byte private key. This is the core space-partitioning strategy where the master controls the prefix and workers iterate over nonce ranges.

---

## Acceptance Criteria

- [ ] Function `ConstructPrivateKey(prefix28 [28]byte, nonce uint32) [32]byte` implemented
- [ ] Nonce is encoded as 4-byte little-endian at the end of the key
- [ ] Function is allocation-free (no heap allocations)
- [ ] Unit tests verify correct byte layout (prefix at start, nonce at end)
- [ ] Unit tests verify little-endian encoding of nonce
- [ ] Tests cover edge cases: nonce=0, nonce=0xFFFFFFFF

---

## Implementation Notes

**Key Points:**
- Reference SDD section: 3.1 (Space Partitioning Strategy)
- Private key structure: `[28 bytes prefix][4 bytes nonce (LE)]`
- Little-endian encoding: LSB first (e.g., nonce=0x01020304 â†’ bytes [0x04, 0x03, 0x02, 0x01])
- Use `encoding/binary` package for endianness conversion
- Performance: This function will be called billions of times, optimize heavily

**Code Pattern:**
```go
func ConstructPrivateKey(prefix28 [28]byte, nonce uint32) [32]byte {
	var key [32]byte
	copy(key[:28], prefix28[:])
	binary.LittleEndian.PutUint32(key[28:], nonce)
	return key
}
```

**Verification:**
- For nonce=0: last 4 bytes should be [0x00, 0x00, 0x00, 0x00]
- For nonce=1: last 4 bytes should be [0x01, 0x00, 0x00, 0x00]
- For nonce=0x12345678: last 4 bytes should be [0x78, 0x56, 0x34, 0x12]

---

## Testing

- Unit test: prefix with nonce=0 produces correct key
- Unit test: prefix with nonce=1 produces correct key
- Unit test: prefix with nonce=0xFFFFFFFF (max value)
- Unit test: verify little-endian byte order explicitly
- Benchmark: measure allocation count (should be 0)

---

## References

- SDD: `docs/architecture/system-design-document.md` (Section 3.1)
- Go binary package: https://pkg.go.dev/encoding/binary
- Related tasks: P06-T040 (uses this function in scanning loop)
