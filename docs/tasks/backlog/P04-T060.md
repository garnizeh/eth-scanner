# P04-T060: Implement UTC timestamp handling for expires_at

**Phase:** P04 - Master API - Job Management (Dynamic Batching)  
**Status:** Not Started  
**Priority:** High  
**Dependencies:** P04-T050  
**Estimated Effort:** Small (< 1h)

---

## Description

Ensure all timestamp handling in the job management system uses UTC exclusively. Verify that lease expiration calculations, database storage, and API responses all use UTC. Add validation to prevent accidental use of local time.

---

## Acceptance Criteria

- [ ] All `time.Now()` calls use `.UTC()` (search codebase for violations)
- [ ] Lease expiration calculated as: `time.Now().UTC().Add(leaseDuration)`
- [ ] Database stores timestamps in UTC format
- [ ] API responses serialize timestamps in ISO 8601 UTC format (trailing 'Z')
- [ ] Code review checklist item added to verify no `time.Local` usage
- [ ] Linter or test catches local time usage (optional: use `staticcheck` or custom test)

---

## Implementation Notes

**Key Points:**
- Reference: `copilot-instructions.md` â€” "Always use UTC for all timestamps"
- Go's `time.Time` can store timezone info; ensure UTC is enforced at creation
- JSON marshaling of `time.Time` automatically uses RFC3339 format

**Pattern to Follow:**
```go
// CORRECT
expiresAt := time.Now().UTC().Add(1 * time.Hour)

// WRONG - never do this
expiresAt := time.Now().Add(1 * time.Hour) // uses local timezone
```

**Verification Test:**
```go
func TestTimestampsAreUTC(t *testing.T) {
    job, _ := manager.LeaseExistingJob(ctx, "worker-1")
    if job.ExpiresAt.Location() != time.UTC {
        t.Error("expires_at is not in UTC")
    }
}
```

---

## Testing

- Audit all timestamp-related code in `internal/jobs/`
- Add unit test verifying ExpiresAt is in UTC location
- Verify API response JSON has timestamps ending in 'Z'

---

## References

- Copilot Instructions: Time Handling section
- Related: P04-T050 (lease endpoint), P04-T020 (lease logic)
