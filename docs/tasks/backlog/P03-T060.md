# P03-T060: Create cmd/master/main.go entry point

**Phase:** P03 - Master API - Core Infrastructure  
**Status:** Not Started  
**Priority:** High  
**Dependencies:** P03-T020  
**Estimated Effort:** Medium

---

## Description

Create the main entry point for the Master API server. This file will wire together all dependencies (config, database, server), initialize the application, and start the HTTP server with proper signal handling.

## Acceptance Criteria

- [ ] File `go/cmd/master/main.go` exists
- [ ] `main()` function loads configuration
- [ ] Database connection initialized using config
- [ ] Server instance created with dependencies
- [ ] Routes registered and server started
- [ ] Graceful shutdown implemented with signal handling (SIGINT, SIGTERM)
- [ ] Application logs startup and shutdown events
- [ ] All errors are properly handled and logged

## Implementation Notes

**Main Function Flow:**
```go
func main() {
    // 1. Load configuration
    cfg, err := config.Load()
    
    // 2. Initialize database connection
    db, err := database.New(cfg.DBPath)
    defer db.Close()
    
    // 3. Initialize database schema
    err = db.Init()
    
    // 4. Create server
    srv := api.NewServer(cfg, db)
    srv.RegisterRoutes()
    
    // 5. Setup signal handling
    ctx, cancel := signal.NotifyContext(context.Background(), os.Interrupt, syscall.SIGTERM)
    defer cancel()
    
    // 6. Start server
    err = srv.Start(ctx)
}
```

**Signal Handling:**
- Catch SIGINT (Ctrl+C) and SIGTERM
- Use `signal.NotifyContext()` for clean context cancellation
- Log shutdown initiation
- Allow time for graceful shutdown (e.g., finish in-flight requests)

**Logging:**
- Log application start with version/build info (optional)
- Log successful initialization steps
- Log listening address
- Log shutdown signal received
- Log clean shutdown completion

**Error Handling:**
All errors must be properly handled and logged. Never ignore errors (linter requirement).
```go
if err != nil {
    log.Fatalf("failed to load config: %v", err)
}
```

**Time Handling:**
When logging, use `time.Now().UTC()` for consistent timestamps.

## Testing

```bash
cd /home/user/code/garnizeh/eth-scanner/go

# Build the binary
make build

# Run the server
./bin/master

# In another terminal, test graceful shutdown
kill -SIGTERM <pid>
```

Manual verification:
- Server starts successfully
- Configuration loaded correctly
- Database initialized
- Health endpoint responds
- Graceful shutdown works on SIGINT/SIGTERM
- All logs are clear and informative

## References

- SDD: `docs/architecture/system-design-document.md`
- Copilot Instructions: Go Code Style - Context, Error Handling, Time (UTC)
- Related tasks: P03-T010 (config), P03-T020 (server), P02-T050 (database), P03-T080 (graceful shutdown)
