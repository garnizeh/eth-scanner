# P03-T070: Test server startup and /health endpoint manually

**Phase:** P03 - Master API - Core Infrastructure  
**Status:** Not Started  
**Priority:** High  
**Dependencies:** P03-T060  
**Estimated Effort:** Small

---

## Description

Perform manual end-to-end testing of the Master API server startup and health check endpoint. This task validates that all Phase 3 components work together correctly in a real runtime environment.

## Acceptance Criteria

- [ ] Server builds successfully without errors
- [ ] Server starts and listens on configured port
- [ ] Health endpoint responds with HTTP 200 OK
- [ ] Health endpoint returns valid JSON
- [ ] Database connectivity check passes
- [ ] Logs show all initialization steps
- [ ] Graceful shutdown works correctly
- [ ] All issues found are documented and fixed

## Implementation Notes

**Test Procedure:**

1. **Build the server:**
```bash
cd /home/user/code/garnizeh/eth-scanner/go
make build
# Verify binary exists at ./bin/master
```

2. **Set environment variables:**
```bash
export MASTER_PORT=8080
export MASTER_DB_PATH=/tmp/eth-scanner-test.db
export MASTER_LOG_LEVEL=debug
```

3. **Start the server:**
```bash
./bin/master
```

Expected output:
```
[INFO] Loading configuration...
[INFO] Initializing database: /tmp/eth-scanner-test.db
[INFO] Database schema initialized
[INFO] Starting server on :8080
```

4. **Test health endpoint:**
```bash
# In another terminal
curl -v http://localhost:8080/health
```

Expected response:
```
HTTP/1.1 200 OK
Content-Type: application/json
X-Request-ID: <some-uuid>

{"status":"ok","timestamp":"2026-02-14T12:34:56Z","database":"connected"}
```

5. **Test with missing database:**
```bash
# Stop server
# Delete database file
rm /tmp/eth-scanner-test.db
# Restart server - should auto-create DB
./bin/master
```

6. **Test graceful shutdown:**
```bash
# Send SIGTERM
kill -SIGTERM <pid>
```

Expected output:
```
[INFO] Shutdown signal received, stopping server...
[INFO] Server stopped gracefully
```

**Test Cases:**
- [ ] Server starts with valid configuration
- [ ] Server starts with missing DB (creates new)
- [ ] Health endpoint returns 200 OK
- [ ] Health response includes valid UTC timestamp
- [ ] Server handles SIGINT (Ctrl+C)
- [ ] Server handles SIGTERM
- [ ] Logs are clear and informative

**Issues to Look For:**
- Memory leaks
- Goroutine leaks
- Database connection not closed
- Middleware not applied
- Incorrect HTTP headers
- Non-UTC timestamps
- Errors not properly logged

## Testing

Manual verification checklist (see Implementation Notes above).

Document any issues in this task file before moving to done.

## References

- SDD: `docs/architecture/system-design-document.md`
- Related tasks: P03-T060 (main.go), P03-T050 (health endpoint)
- Next: P03-T080 (refine graceful shutdown if issues found)
