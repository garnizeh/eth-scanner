# P04-T120: Create GET /api/v1/stats handler (return statistics from view)

**Phase:** P04 - Master API - Job Management (Dynamic Batching)  
**Status:** Not Started  
**Priority:** Low  
**Dependencies:** P04-T010, P02-T040  
**Estimated Effort:** Small (< 1h)

---

## Description

Implement a statistics endpoint that provides overview metrics about the scanning operation. This endpoint queries the database to return counts of jobs by status, total keys scanned, active workers, and other useful metrics.

---

## Acceptance Criteria

- [ ] Handler `handleStats` implemented
- [ ] Accepts GET request to `/api/v1/stats`
- [ ] Returns JSON with statistics: total jobs, jobs by status, total keys scanned, active workers
- [ ] Uses database view `job_stats` if available, or aggregate queries
- [ ] Returns 200 OK with stats JSON
- [ ] No authentication required (read-only, public stats)
- [ ] Route registered in `routes.go`

---

## Implementation Notes

**Key Points:**
- Reference SDD: Statistics view for monitoring
- This endpoint is useful for monitoring dashboards
- Consider caching results if database grows large (future optimization)

**Response Schema:**
```json
{
  "total_jobs": 1500,
  "jobs_by_status": {
    "pending": 100,
    "processing": 50,
    "completed": 1350
  },
  "total_keys_scanned": 1500000000,
  "active_workers": 12,
  "results_found": 0,
  "timestamp": "2026-02-15T16:00:00Z"
}
```

**SQL Queries:**
```sql
-- Total jobs by status
SELECT status, COUNT(*) FROM jobs GROUP BY status;

-- Total keys scanned
SELECT SUM(keys_scanned) FROM jobs;

-- Active workers (processing jobs not expired)
SELECT COUNT(DISTINCT worker_id) FROM jobs 
WHERE status = 'processing' AND expires_at > ?;

-- Results found
SELECT COUNT(*) FROM results;
```

---

## Testing

- Test stats endpoint returns valid JSON
- Test empty database (all counts = 0)
- Test with various job states
- Verify timestamp is UTC

---

## References

- SDD: Monitoring and observability
- Database: Aggregate queries on jobs and results tables
- Optional: Create database view for better performance
