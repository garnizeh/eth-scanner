---
id: A01-T100
title: Configure PC worker goroutine count via env var
status: Not Started
owner: TBD
created: 2026-02-18
tags:
  - worker
  - runtime
  - config
---

## Summary

Allow the PC worker to be configured with a fixed number of scanning goroutines via an environment variable (fallback to `runtime.NumCPU()` when unset or zero).

## Motivation

Operators need an easy way to limit CPU usage on machines running the PC worker without changing source code.

## Acceptance criteria

- Add configuration option `WORKER_NUM_GOROUTINES` (or similar) to the worker config.
- When set to a positive integer, use it instead of `runtime.NumCPU()` when spawning scan goroutines.
- When unset, zero, or invalid, fallback to `runtime.NumCPU()`.
- Add unit tests covering: env var set, unset, invalid value, and zero value fallback.
- Update docs: `docs/tasks/backlog/A01-T100.md` and `README` worker run section.

## Implementation notes

- Update the worker config loader to read the env var and expose it on the runtime config.
- Use `strconv.Atoi` with proper error handling and wrapping.
- Ensure behavior is deterministic in tests by injecting the config rather than relying on actual runtime.NumCPU().

## Steps

1. Add config field to `internal/config` and env parsing.
2. Wire the config into worker startup and pass `numWorkers` into `ScanRangeParallel`.
3. Add unit tests for config and worker behavior.
4. Update documentation.
